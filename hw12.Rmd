---
title: "Homework 12"
author: "Ismam Ferdous"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE,fig.width=5,fig.height=4,fig.align="center")

###
### REMEMBER TO:  1. set your working directory
###               2. import necessary packages (run line below)

library(tidyverse)
```


## Q1

Revisiting the penguins dataset, do the following **for each species** using tidyverse syntax:

a. Remake the bar plot showing average body mass for each species and for each sex (you can just copy the code from section 8.1.1 of the notes if you wish).

b. Construct and interpret 95% confidence intervals for the mean difference in body mass (male–female).

c. Do a standard α=0.05 level hypothesis test to see if male penguins are heavier on average than female penguins.


```{r}


# a. bar plot : 
penguins <- read_csv("https://bwu62.github.io/stat240-revamp/data/penguins.csv")

penguins %>% 
  group_by(species, sex) %>% 
  summarize(mean_mass = mean(body_mass_g), .groups = "drop") %>% 
  ggplot(aes(x = species, y = mean_mass, fill = sex)) +
  geom_col(position = "dodge") +
  labs(
    x = "Species",
    y = "Mean body mass (g)",
    title = "Mean body mass by species and sex"
  )

# b. CI's 

penguin_diff <- penguins %>% 
  group_by(species, sex) %>% 
  summarize(
    mean_mass = mean(body_mass_g),
    sd_mass   = sd(body_mass_g),
    n         = n(),
    .groups = "drop"
  ) %>% 
  pivot_wider(
    names_from = sex,
    values_from = c(mean_mass, sd_mass, n)
  ) %>% 
  mutate(
    diff_mean = mean_mass_male - mean_mass_female,
    se_diff = sqrt(
      sd_mass_male^2 / n_male + sd_mass_female^2 / n_female
    ),
    t_crit = qt(0.975, df = n_male + n_female - 2),
    ci_low  = diff_mean - t_crit * se_diff,
    ci_high = diff_mean + t_crit * se_diff
  )

penguin_diff

#c. c. Hypothesis tests if the males are heavier?

penguin_tests <- penguins %>% 
  group_by(species) %>% 
  summarize(
    t_test = list(t.test(
      body_mass_g ~ sex,
      data = cur_data(),
      alternative = "greater",
      var.equal = TRUE
    )),
    .groups = "drop"
  ) %>% 
  mutate(
    t_stat = map_dbl(t_test, "statistic"),
    p_value = map_dbl(t_test, "p.value")
  ) %>% 
  select(species, t_stat, p_value)

penguin_tests

```







## Q2

From the `MASS` package, load in the `cats` dataset (just install & import the package and you should have it). This dataset contains body weight (kg) and heart weight (g) data from a sample of domestic cats. For the rest of the problem, consider body weight as the predictor and heart weight as the response.

a. Plot the dataset, additionally using color to distinguish the `Sex` of the cats. Does there appear to be strong differences between the sexes?

b. Compute the correlation coefficient both manually and using R for this dataset. Does there appear to be a strong linear relationship, and in what direction?

c. Compute the best fit coefficients both manually and using R's `lm()` function, and print the summary output.

d. Check the residual plots of the fit. Does the model appear well fit?

e. Compute both a 95% confidence interval for the true slope and run a standard α=0.05 level significant test for the fitted slope vs 0. Does there appear to be significant linear relationship?

f. Find a 95% confidence interval for the mean heart weight of 8-pound cats.

g. You rescue a new cat who's approximately 8 pounds. Give a 95% prediction interval for its heart weight.


```{r}

library(MASS)
data(cats)

#a. plotting : 

ggplot(cats, aes(x = Bwt, y = Hwt, color = Sex)) +
  geom_point()

#b. correlation coefficient : 

# manual
r_manual <- with(cats, cor(Bwt, Hwt))

# or directly
cor_BH <- cor(cats$Bwt, cats$Hwt)
r_manual; cor_BH


#c. the best fit line

fit <- lm(Hwt ~ Bwt, data = cats)
coef(fit)       

summary(fit)     


#d . residual plots
par(mfrow = c(1, 2))
plot(fit, which = 1)  # residuals vs fitted
plot(fit, which = 2)  # normal Q–Q
par(mfrow = c(1, 1))


#e. inference for the slopes : 

confint(fit, level = 0.95)  # 95% CI for intercept and slope
summary(fit)$coefficients   # includes t-test and p-value for slope


#f. CI for mean hearts weight at 8lbs : 

new_cat <- data.frame(Bwt = 8 / 2.2)
predict(fit, newdata = new_cat, interval = "confidence", level = 0.95)


#g, PU for a single 8lb cat : 

predict(fit, newdata = new_cat, interval = "prediction", level = 0.95)






































```

